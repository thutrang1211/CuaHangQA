 CREATE DATABASE DuAn1
USE DuAn1
GO
-- CuaHang
IF OBJECT_ID('CuaHang') IS NOT NULL
	DROP TABLE CuaHang
GO
CREATE TABLE CuaHang(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenCH NVARCHAR(50) DEFAULT NULL,
SoNV INT DEFAULT NULL,
ThanhPho NVARCHAR(50) DEFAULT NULL,
Quan NVARCHAR(50) DEFAULT NULL,
SoNha NVARCHAR(50) DEFAULT NULL,
IdQL UNIQUEIDENTIFIER,
IdNV UNIQUEIDENTIFIER,
TrangThai int DEFAULT 0
)
Go
-- QuanLy
IF OBJECT_ID('QuanLy') IS NOT NULL
	DROP TABLE QuanLy
GO
CREATE TABLE QuanLy(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenQL NVARCHAR(50) DEFAULT NULL,
GioiTinh BIT DEFAULT NULL,
SDT VARCHAR(30) DEFAULT NULL,
Email NVARCHAR(50) DEFAULT NULL,
NgayVao DATE DEFAULT NULL,
NgayLamQuanLy DATE DEFAULT NULL,
MatKhau VARCHAR(MAX) DEFAULT NULL,
TrangThai int DEFAULT 0
)
Go
-- NhaCungCap
IF OBJECT_ID('NhaCungCap') IS NOT NULL
	DROP TABLE NhaCungCap
GO
CREATE TABLE NhaCungCap(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenNcc NVARCHAR(50) DEFAULT NULL,
SDT VARCHAR(30) DEFAULT NULL,
Email NVARCHAR(50) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
--SanPham
IF OBJECT_ID('SanPham') IS NOT NULL
	DROP TABLE SanPham
GO
CREATE TABLE SanPham(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenSP NVARCHAR(50) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
-- LoaiSanPham
IF OBJECT_ID('LoaiSanPham') IS NOT NULL
	DROP TABLE LoaiSanPham
GO
CREATE TABLE LoaiSanPham(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenLoai NVARCHAR(50) DEFAULT NULL,
CongDung NVARCHAR(50) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
-- ChatLieu
IF OBJECT_ID('ChatLieu') IS NOT NULL
	DROP TABLE ChatLieu
GO
CREATE TABLE ChatLieu(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenCL NVARCHAR(50) DEFAULT NULL,
DacTinh NVARCHAR(50) DEFAULT NULL,
QuyTrinhSX NVARCHAR(30) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
-- MauSac
IF OBJECT_ID('MauSac') IS NOT NULL
	DROP TABLE MauSac
GO
CREATE TABLE MauSac(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenMau NVARCHAR(50) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
-- Size
IF OBJECT_ID('Size') IS NOT NULL
	DROP TABLE Size
GO
CREATE TABLE Size(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenSize NVARCHAR(50) DEFAULT NULL,
NgayTao DATE DEFAULT NULL,
NgaySua DATE DEFAULT NULL,
TrangThai BIT NULL
)
Go
--NhanVien
IF OBJECT_ID('NhanVien') IS NOT NULL
	DROP TABLE NhanVien
GO
CREATE TABLE NhanVien(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenNV NVARCHAR(50) DEFAULT NULL,
GioiTinh BIT DEFAULT NULL,
NgaySinh DATE DEFAULT NULL,
SDT VARCHAR(30) DEFAULT NULL,
DiaChi NVARCHAR(50) DEFAULT NULL,
Email NVARCHAR(50) DEFAULT NULL,
NgayVao DATE DEFAULT NULL,
MatKhau VARCHAR(MAX) DEFAULT NULL,
NgayCong INT DEFAULT NULL,
Luong DECIMAL(20,0) DEFAULT NULL,
TrangThai INT DEFAULT 0
)
Go
--KhachHang
IF OBJECT_ID('KhachHang') IS NOT NULL
	DROP TABLE KhachHang
GO
CREATE TABLE KhachHang(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
TenKH NVARCHAR(50) DEFAULT NULL,
GioiTinh BIT DEFAULT NULL,
NgaySinh DATE DEFAULT NULL,
SDT VARCHAR(30) DEFAULT NULL,
DiaChi NVARCHAR(50) DEFAULT NULL,
Email NVARCHAR(50) DEFAULT NULL,
TrangThai int DEFAULT 0
)
Go
--KhuyenMai
IF OBJECT_ID('KhuyenMai') IS NOT NULL
	DROP TABLE KhuyenMai
GO
CREATE TABLE KhuyenMai(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
Ma VARCHAR(20) UNIQUE,
NgayBD DATE DEFAULT NULL,
NgayKT DATE DEFAULT NULL,
TinhTrang BIT DEFAULT NULL,
GiaTriKM DECIMAL (20,0) DEFAULT NULL
)
Go
--HoaDon
IF OBJECT_ID('HoaDon') IS NOT NULL
	DROP TABLE HoaDon
GO
CREATE TABLE HoaDon(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
IdKH UNIQUEIDENTIFIER,
IdNV UNIQUEIDENTIFIER,
IdKM UNIQUEIDENTIFIER,
Ma VARCHAR(20) UNIQUE,
NgayTao DATE DEFAULT NULL,
NgayThu DATE DEFAULT NULL,
TinhTrang INT DEFAULT NULL,
TenNguoiNhan NVARCHAR(50) DEFAULT NULL,
DiaChi NVARCHAR(50) DEFAULT NULL,
SDT VARCHAR(30) DEFAULT NULL,
TrangThai int DEFAULT 0
)
Go
--ChiTietSP
IF OBJECT_ID('ChiTietSP') IS NOT NULL
	DROP TABLE ChiTietSP
GO
CREATE TABLE ChiTietSP(
Id UNIQUEIDENTIFIER PRIMARY KEY DEFAULT NEWID(),
IdSP UNIQUEIDENTIFIER,
IdLSP UNIQUEIDENTIFIER,
IdMS UNIQUEIDENTIFIER,
IdCL UNIQUEIDENTIFIER,
IdSz UNIQUEIDENTIFIER,
IdNcc UNIQUEIDENTIFIER,
SoLuongTon INT DEFAULT NULL,
GiaNhap DECIMAL(20,0) DEFAULT NULL,
GiaBan DECIMAL(20,0) DEFAULT NULL,
MoTa NVARCHAR(50) DEFAULT NULL,
TrangThai bit DEFAULT NULL
)
Go
--ChiTietHD
IF OBJECT_ID('ChiTietHD') IS NOT NULL
	DROP TABLE ChiTietHD
GO
CREATE TABLE ChiTietHD(
id UNIQUEIDENTIFIER primary key DEFAULT NEWID(),
IdHD UNIQUEIDENTIFIER,
IdCTSP UNIQUEIDENTIFIER,
SoLuong INT DEFAULT NULL,
DonGia DECIMAL(20,0) DEFAULT NULL,
CONSTRAINT FK12 FOREIGN KEY(IdHD) REFERENCES HoaDon(Id),
CONSTRAINT FK13 FOREIGN KEY(IdCTSP) REFERENCES ChiTietSP(Id),
)
Go
IF OBJECT_ID('Trahang') IS NOT NULL
	DROP TABLE trahang
GO
CREATE TABLE trahang(
Id UNIQUEIDENTIFIER  DEFAULT NEWID(),
IdKH UNIQUEIDENTIFIER,
IdHD UNIQUEIDENTIFIER,
TenKH NVARCHAR(50) DEFAULT NULL,
NgayTra DATE DEFAULT NULL,
SoLuong INT DEFAULT NULL,
DonGia DECIMAL(20,0) DEFAULT NULL,

Constraint PK_trahang PRIMARY KEY (Id),
CONSTRAINT FK14 FOREIGN KEY(IdKH) REFERENCES khachhang (Id),
CONSTRAINT FK15 FOREIGN KEY(IdHD) REFERENCES HoaDon(Id)
)
Go
/*Quan hệ với các bảng */
--Cửa hàng với Quản lý và nhân viên
ALTER TABLE CuaHang ADD FOREIGN KEY(IdQL) REFERENCES QuanLy(Id)
ALTER TABLE CuaHang ADD FOREIGN KEY(IdNV) REFERENCES NhanVien(Id)
--Hóa đơn với Khách hàng , Nhân viên, Khuyến mãi
ALTER TABLE HoaDon ADD FOREIGN KEY(IdKH) REFERENCES KhachHang(Id)
ALTER TABLE HoaDon ADD FOREIGN KEY(IdNV) REFERENCES NhanVien(Id)
ALTER TABLE HoaDon ADD FOREIGN KEY(IdKM) REFERENCES KhuyenMai(Id)
--Chi tiết sp với SanPham, Loại sp, Màu sắc, Chất liệu, Size, NhaCungCap
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdSP) REFERENCES SanPham(Id)
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdLSP) REFERENCES LoaiSanPham(Id)
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdMS) REFERENCES MauSac(Id)
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdCL) REFERENCES ChatLieu(Id)
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdSz) REFERENCES Size(Id)
ALTER TABLE ChiTietSP ADD FOREIGN KEY(IdNcc) REFERENCES NhaCungCap(Id)


/*insert dữ liệu vào bảng*/
Delete from SanPham
insert into SanPham values
('38859075-2257-4830-a572-95450ef0b091','SP01',N'Áo Polo','01/11/2022','10/11/2022',0),
('38859075-2257-4830-a572-95450ef0b092','SP02',N'Áo Len','02/11/2022','11/11/2022',0),
('38859075-2257-4830-a572-95450ef0b093','SP03',N'Áo Dạ','03/11/2022','12/11/2022',0)

Delete from	LoaiSanPham
insert into LoaiSanPham values
('f738fa9c-4770-4fff-bcfb-7f60f6e5a9c1','LSP01',N'Bên Trong',N'Mát','04/11/2022','11/11/2022',0),
('f738fa9c-4770-4fff-bcfb-7f60f6e5a9c2','LSP02',N'Bên Ngoài',N'Giữ ấm','05/11/2022','11/11/2022',0)

Delete from MauSac
insert into MauSac values
('cabee634-1852-4fca-ac01-78d14b4b811e','MS01',N'Đỏ','06/11/2022','11/11/2022',0),
('cabee634-1852-4fca-ac01-78d14b4b801e','MS02',N'Xanh','07/11/2022','11/11/2022',0),
('cabee634-1852-4fca-ac01-78d14b4b821e','MS03',N'Trắng','08/11/2022','11/11/2022',0)

Delete from ChatLieu
insert into ChatLieu values
('fc8d3f9f-a1f4-402a-a967-eac8c7b020c0','CL01',N'Vải',N'Mát',N'Thủ công','09/11/2022','11/11/2022',0),
('fc8d3f9f-a1f4-402a-a967-eac8c7b020c1','CL02',N'Len',N'Ấm',N'Công nghiệp','10/11/2022','11/11/2022',0),
('fc8d3f9f-a1f4-402a-a967-eac8c7b020c2','CL03',N'Lỉ',N'Ấm',N'Thủ công','11/11/2022','11/11/2022',0)
Delete from Size
insert into Size values
('08d79354-59b3-4927-b3c6-d372bd408a9a','Sz01','s','01/11/2022','11/11/2022',0),
('08d79354-59b3-4927-b3c6-d372bd408a8a','Sz02','m','02/11/2022','11/11/2022',0),
('08d79354-59b3-4927-b3c6-d372bd408a7a','Sz03','l','03/11/2022','11/11/2022',0),
('08d79354-59b3-4927-b3c6-d372bd408a6a','Sz04','xl','04/11/2022','11/11/2022',0)
Delete from NhaCungCap
insert into NhaCungCap values
('3094f4e2-8128-43ba-9200-966dfbe5b876','Nsx01','Nokia',0123456789,'Nokia@gmail.com','05/11/2022','11/11/2022',0),
('3094f4e2-8128-43ba-9200-966dfbe5b877','Nsx02','Gucci',0123456788,'Gucci@gmail.com','06/11/2022','11/11/2022',0),
('3094f4e2-8128-43ba-9200-966dfbe5b878','Nsx03','Chanel',0123456786,'Chanel@gmail.com','07/11/2022','11/11/2022',0)

Delete from ChiTietSP
insert into ChiTietSP values
('f33bdbe6-579e-4092-9551-134e1fda3393','38859075-2257-4830-a572-95450ef0b091','f738fa9c-4770-4fff-bcfb-7f60f6e5a9c1','cabee634-1852-4fca-ac01-78d14b4b811e',
'fc8d3f9f-a1f4-402a-a967-eac8c7b020c0','08d79354-59b3-4927-b3c6-d372bd408a9a','3094f4e2-8128-43ba-9200-966dfbe5b876',1,10000.0,11000.0,N'Đẹp',1)
Delete from KhachHang
insert into KhachHang values
('c3634bb5-0364-482e-98f1-505492717528','KH01',N'Huynh',0,'07/11/2003','0123456789','NinhBinh','huynhcd@fpt.edu.vn',0),
('c3634bb5-0364-482e-98f1-505492717527','KH02',N'Đại',0,'07/18/2003','0123456788','ThaiBinh','daivm@fpt.edu.vn',0)

Delete from NhanVien
insert into NhanVien values
('cba356ff-e4a4-412d-b6d8-974bb49e2158','NV01',N'Nhân',1,'05/05/2003','1234567890',N'Phú Thọ','Nhanvqh@fpt.edu.vn','01/01/2022','123',12,120000,0),
('cba356ff-e4a4-412d-b6d8-974bb49e2169','NV02',N'Đại',1,'06/06/2003','1234567899',N'Thái Bình','Daivm@fpt.edu.vn','08/08/2022','123',10,150000,0)

Delete from HoaDon
insert into HoaDon values
('9ec25514-d66d-44cf-a723-bf481e69c667','c3634bb5-0364-482e-98f1-505492717528','cba356ff-e4a4-412d-b6d8-974bb49e2158',null,'HD01','01-01-2022','02-01-2022',null,null,N'DiaChi1','0123456789',0)
Delete from ChiTietHD
insert into ChiTietHD values
('048cd0b4-dfd3-4b97-88f5-3e166612c781','9ec25514-d66d-44cf-a723-bf481e69c667','f33bdbe6-579e-4092-9551-134e1fda3393',1,null)

SELECT dbo.KhachHang.ma,dbo.HoaDon.Ma,
                dbo.KhachHang.TenKH, dbo.HoaDon.NgayTao, dbo.HoaDon.NgayThu, 
                dbo.HoaDon.DiaChi, dbo.HoaDon.SDT, dbo.HoaDon.TinhTrang
                FROM   dbo.HoaDon INNER JOIN
                 dbo.KhachHang ON dbo.HoaDon.IdKH = dbo.KhachHang.Id

				 select KhachHang.TenKH,HoaDon.Ma,ChiTietHD.SoLuong,ChiTietHD.DonGia 
                      from KhachHang 
                       join HoaDon on KhachHang.id = HoaDon.IdKH 
                       join ChiTietHD on HoaDon.Id = ChiTietHD.IdHD

					   select*from HoaDon
					   Select*from KhachHang
					   select*from chitietsp
					   select*from SanPham
					   select*from LoaiSanPham
					   select*from MauSac
					   select*from ChatLieu
					   select*from Size
					   select*from NhaCungCap
